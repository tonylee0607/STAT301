---
jupyter:
  jupytext:
    formats: ipynb,Rmd
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.16.0
  kernelspec:
    display_name: R
    language: R
    name: ir
---

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "2d0f31d79866375b7f3161d0277a32a3", "grade": false, "grade_id": "cell-f1e1d845873036f4", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
# Tutorial 12: Binary or Discrete Counts Responses
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "d94e81925b1456028fb504d00e3a9284", "grade": false, "grade_id": "cell-82d9926086d47a80", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### Lecture and Tutorial Learning Goals:
After completing this week's lecture and tutorial work, you will be able to:

1. Describe the logistic regression estimation procedure (categorical data as the response variable and explanatory variables), and Poisson regression estimation procedure (discrete counts as the response variable and explanatory variables).
2. Discuss the relationship between linear regression and logistic and Poisson regression. Discuss the consequences of modeling data that is more suitable for logistic and Poisson regression models as a linear regression model.
3. Interpret the coefficients and $p$-values in the logistic and Poisson regression settings.
4. Discuss useful diagnostics for logistic and Poisson regression and explain why they should be performed.
5. Write a computer script to perform logistic and Poisson regression and perform model diagnostics. Interpret and communicate the results from that computer script.
<!-- #endregion -->

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '6dd126a878384f00ec2c6c116565c9ff', 'grade': False, 'grade_id': 'cell-a2a153352bc44a68', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
# Run this cell before continuing.
library(tidyverse)
library(repr)
library(infer)
library(gridExtra)
library(mlbench)
library(AER)
library(ISLR)
library(broom)
library(qqplotr)
library(performance)
library(see)
library(MASS)
library(glmbb)
library(cowplot)
source("tests_tutorial_12.R")
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "d500b40fbbd8d191dc155e0b17c231df", "grade": false, "grade_id": "cell-801b28434bf00853", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
## 1. Poisson Regression

Let us proceed with Poisson regression. This class of GLM is intended for cases where the response is a count (i.e., an integer). What do we mean by this? Firstly, we will load the dataset to be used in this section. The data frame `crabs` ([Brockmann, 1996](https://ubc.summon.serialssolutions.com/2.0.0/link/0/eLvHCXMwrV3JasMwEBUlpZBLl7Sl6YY_oE4sy5sgFEpICKU9NadcjFYSmtghCyRf0t-tJC_EPhRaepMHS8jSSPM0M3oGALkdx67tCYRyKV0GacCp9CBX60RCySMcYiigy2qpOq_F1ZiMLqL0v-mFYrZvvd4JXXcPEnOUZbU1z6W-fxdoh6eO-XQUvDyGCnXrbK_hxCkDDCHKgs9KH20FelDOR_pzWxXbdYhljTEanoF10e8iC6V2SbDK9Pg_H3gOTnPsar1kynYBjkTSAs1yC923wMkkNaVL8NVbkNXn8wcxjJ8b0euaZysTvyuzVJUYH9i6Kpsl1ijVOSbTtPZ2f6V6nYuectnbbLGdb2tNLNP5fjkVi1J-BcbDwbg_svOfQNhMIRdsu4KHEnIsIiQYJoGQvsKQmAuOsE8lojRnrPEIlZQHHIUEEs8PBVHQjaJr0EjSRNwAS8ebmMNk4DHkRYgQSt2ARoxRnzuhJG2AitmNlxnVR3x4REI41sMf6-GP8-GPd20QmVn7RZV4MB7p0u3fq96BZpY-rn1B96CxWW3FgyGOeDR6_g1rIQSN)) is a dataset detailing the **counts** of satellite male crabs residing around a female crab nest: `n_males`. 

> The data frame `crabs` contains 173 observations on horseshoe crabs (*Limulus polyphemus*). The response is the count of male crabs (`n_males`) around a female breeding nest. It is subject to four input variables: a factor for the `color` of the prosoma with four levels, a factor for the condition of the posterior `spine` with three levels, the continuous variables for carapace `width` (cm), and `weight` (g).

Run the cell below before proceeding.
<!-- #endregion -->

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'd7f194427d74287ab36175b312da4159', 'grade': False, 'grade_id': 'cell-c42393c3147ab6d0', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
data(crabs)
crabs <- crabs %>%
  rename(n_males = satell) %>%
  dplyr::select(-y)

str(crabs)
head(crabs)
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "53940b5e4147ecc0a1d918a66012392c", "grade": false, "grade_id": "cell-3245a397a3c0a56f", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.1**
<br>{points: 1}

Create a scatterplot of `n_males` versus carapace `width` (via `geom_point()`), even though `n_males` is not continuous. The `ggplot()` object's name will be `Crabs_vs_width_scatterplot`. Recall that the response must be placed on the $y$-axis, whereas the continuous input must be on the $x$-axis. Include proper axis labels and title.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '4e3dcaff4a02b8b0c12a3587d988c936', 'grade': False, 'grade_id': 'cell-267744b8584d386b', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# Crabs_vs_width_scatterplot <- 
#   ... %>%
#   ggplot() +
#   ...(aes(..., ...)) +
#   labs(y = ..., x = ...) +
#   ggtitle(...) +
#   theme(
#     text = element_text(size = 16.5),
#     plot.title = element_text(face = "bold"),
#     axis.title = element_text(face = "bold"),
#     legend.title = element_text(face = "bold")) + 
#   scale_x_continuous(breaks = seq(20, 34, 2))

# your code here
Crabs_vs_width_scatterplot <- 
  crabs %>%
  ggplot() +
  geom_point(aes(width, n_males)) +
  labs(y = "Number Of Male Crabs", x = "Width in cm") +
  ggtitle("Crabs vs width in scatterplot") +
  theme(
    text = element_text(size = 16.5),
    plot.title = element_text(face = "bold"),
    axis.title = element_text(face = "bold"),
    legend.title = element_text(face = "bold")) + 
  scale_x_continuous(breaks = seq(20, 34, 2))

Crabs_vs_width_scatterplot
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '0ab5a2b196ff6c3c1ed3a2b30946f711', 'grade': True, 'grade_id': 'cell-4ea95eb36fa39c91', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.1()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "6142c87aa6d0d6518e09687fd9fa8908", "grade": false, "grade_id": "cell-c3c5c48f76ee8a52", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
Note the characteristic horizontal pattern in the points of `Crabs_vs_width_scatterplot`, since the $y$-axis has repeated counts associated with different `width` values. Graphically speaking, is the variable the carapace `width` associated with `n_males`?

From the `Crabs_vs_width_scatterplot` above, it is hard to graphically conclude something about the relationship between `n_males` and caparace `width`. Hence, let us plot the average `n_males` by non-overlapped carapace `width` groups. 
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "5033c071993b6ed60129dcf2bbd9196c", "grade": false, "grade_id": "cell-d8dc6bd50a1e51f1", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.2**
<br>{points: 1}

Create a data frame called `Crabs_group_avg_width`, which is created from `crabs` and has two columns:

- `width_intervals`: a column created with column `width` via function `cut()` with `breaks = 10` (i.e., bins).
- `mean_n_males`: the average `n_males` by each bin.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'e6cfebcffc2b10cd7d5b47614f365c70', 'grade': False, 'grade_id': 'cell-e136e294390e75db', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# Crabs_group_avg_width <- 
#  ... %>%
#  ...(width_intervals = ...(..., ...)) %>%
#  group_by(...) %>% 
#  summarise(... = ...(...)) 

# your code here
Crabs_group_avg_width <- 
 crabs %>%
 mutate(width_intervals = cut(width, breaks = 10)) %>%
 group_by(width_intervals) %>% 
 summarise(mean_n_males = mean(n_males)) 

Crabs_group_avg_width
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '429c9f614730ce806230cd149ce6cd13', 'grade': True, 'grade_id': 'cell-24bf5f18b3ee2717', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.2()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "5ab1e5a66cefd3b5a20e56692594c572", "grade": false, "grade_id": "cell-fcf23138e5f9e32f", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.3**
<br>{points: 1}

Create another scatterplot of `mean_n_males` on the $y$-axis versus the carapace `width_intervals` on the $x$-axis using `Crabs_group_avg_width` with `geom_point()`. The `ggplot()` object's name will be `Crabs_avg_width_scatterplot`. Include proper axis labels and title.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '062821791d38686c9c2f8ec6bba4af44', 'grade': False, 'grade_id': 'cell-72dcede930e14421', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# Crabs_avg_width_scatterplot <- ... %>%
#   ggplot() +
#   ...(aes(..., ...), colour = "red", size = 4) +
#   labs(y = ..., x = ...) +
#   ggtitle(...) +
#   theme(
#     text = element_text(size = 14),
#     plot.title = element_text(face = "bold"),
#     axis.title = element_text(face = "bold"),
#     legend.title = element_text(face = "bold"),
#     axis.text.x = element_text(angle = 45, hjust = 1)
#   )

# your code here
Crabs_avg_width_scatterplot <- Crabs_group_avg_width %>%
  ggplot() +
  geom_point(aes(width_intervals, mean_n_males), colour = "red", size = 4) +
  labs(y = "Mean Number of Male Crabs", x = "width intervals") +
  ggtitle("Crab avg width in scatterplot") +
  theme(
    text = element_text(size = 14),
    plot.title = element_text(face = "bold"),
    axis.title = element_text(face = "bold"),
    legend.title = element_text(face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

options(repr.plot.width = 15, repr.plot.height = 7)
plot_grid(Crabs_vs_width_scatterplot, Crabs_avg_width_scatterplot, ncol = 2)
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '06d23e2fc7522963d9ad92d2bc5ceedc', 'grade': True, 'grade_id': 'cell-c470e7f855f8f4c8', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.3()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "a227e6065d0254d0e966f2b955bdde66", "grade": false, "grade_id": "cell-58f301f5cab01d1a", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.4**
<br>{points: 1}

By looking at `Crabs_avg_width_scatterplot`, graphically speaking, what is the relationship between `n_males` and carapace `width`?

**A.** Positive.

**B.** Negative.

**C.** No relationship.

*Assign your answer to the object `answer1.4` (character type surrounded by quotes).*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'd417bb44aa9ac1ad7ea23c927da2496f', 'grade': False, 'grade_id': 'cell-5f4531deea0754da', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer1.4 <- ...

# your code here
answer1.4 <- "A"

answer1.4
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '3fe969a9a11de52d0812d9d263da9ee1', 'grade': True, 'grade_id': 'cell-32224ab4e0d00a59', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.4()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "ca474bd507ac23a98657c19cea770765", "grade": false, "grade_id": "cell-98e957ee7f6dfc9c", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
If we compare `Crabs_vs_width_scatterplot` and `Crabs_avg_width_scatterplot`, we can see that working with the averages of `n_males` by carapace `width` intervals gives us a clearer perspective of the relationship between these two variables. Nonetheless, we need to find a suitable model to confirm this statistically.

Recall that the residual component in an ordinary linear regression model, namely $\varepsilon_i$, is assumed to be Normally distributed, making the response $Y_i$ Normally distributed. In this case, our response variable is the "Number of male crabs" (count!). Counts distributions can be asymmetric, and they are non-negative, thus the Normal distribution might not be adequate. Nor the logistic regression, since we are not estimating proportions. 

A very useful distribution to model counts (not the only one!) is the Poisson distribution. 
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "5790238897dcac0b0d03098c3cb3fa8f", "grade": false, "grade_id": "cell-d07f008bc4129b8f", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**The Poisson Regression**

A Poisson random variable takes discrete non-negative integer values that count something in a given timeframe or even in a space such as a geographic unit. A particularity of the Poisson distribution is that its mean is equal to its variance. Thus, any factor that affects the mean will also affect the variance. This fact could be a potential drawback for using a Poisson regression model.

The Poisson regression model is given by:

$$Y_i|\mathbf{X}_i \sim \text{Poisson}(\lambda_i),$$

$$\log(\lambda_i) = \beta_0 + \beta_1X_{1,i} + \ldots + \beta_pX_{1,p}$$

or equivalently,

$$\lambda_i = e^{\beta_0 + \beta_1X_{1,i} + \ldots + \beta_pX_{1,p}}$$

where each variable has its own mean, $\lambda_i$, and variance, also $\lambda_i$. The parameter $\lambda_i$ is interpreted as the risk of an event occurring in a given timeframe or even a space. Note that $\lambda_i$ cannot be negative, hence it is a useful function to link $E[Y_i|\mathbf{X}_i]=\lambda_i$ with the the linear component.
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "e4b6ad031020360f52082c24f73240fe", "grade": false, "grade_id": "cell-27605b7706aedb71", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.5**
<br>{points: 1}

For our `crabs` dataset the events are the number of male crabs, `n_males`, around a space: the female breeding nest. Suppose we want to make inference on whether the carapace `width` is related to the response `n_males`. Thus, we could use Poisson regression. Let $X_{\texttt{width}_i}$ be the $i$th value for the input `width` in our dataset `crabs`. The model's regression equation will be:

$$\log(\lambda_i) = \beta_0 + \beta_1 X_{\texttt{width}_i}.$$

Let us plot the predictions of this model on top of `Crabs_vs_width_scatterplot`. Use `geom_smooth()` with `method = "glm"` and `method.args = list(family = poisson)`.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'dcf2caa2b54bc8b29705e3acac978768', 'grade': False, 'grade_id': 'cell-3a1e6d7e495e79d0', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# Crabs_vs_width_scatterplot <- 
#   Crabs_vs_width_scatterplot +
#   ...(
#     aes(..., ...), 
#     ..., se = FALSE,
#     ...)

# your code here
Crabs_vs_width_scatterplot <- 
  Crabs_vs_width_scatterplot +
  geom_smooth(
    aes(width, n_males), 
    method = "glm", se = FALSE,
    method.args = list(family = poisson))

Crabs_vs_width_scatterplot
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '419c75caf1de4a00fff5719224bc8cb6', 'grade': True, 'grade_id': 'cell-e6f45c72012f6548', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.5()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "29bc289c41116e36fe2426e5055d88eb", "grade": false, "grade_id": "cell-04bbdae892ba5783", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
As seen in other models, the parameters $\beta_0, \beta_1, \dots, \beta_{p}$ are unknown population coefficients that we want to estimate using data. 

In order to fit a Poisson regression model, we can also use the function `glm()` and its argument `family = poisson` (required to specify the Poisson nature of the response), which obtains the estimates $\hat{\beta}_0, \hat{\beta}_1, \dots \hat{\beta}_{p}$. The estimates are obtained through maximum likelihood where we assume a Poisson joint probability mass function of the $n$ responses $Y_i$.
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "7709c39efbfc26544edb44656db777bd", "grade": false, "grade_id": "cell-1cd6b2d8388adfad", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.6**
<br>{points: 1}

Using `glm()`, estimate a Poisson regression model with `n_males` as a response and two input variables: `width` ($X_{\texttt{width}_i}$) and `color` ($X_{\texttt{color_darker}_i}$, $X_{\texttt{color_light}_i}$, and $X_{\texttt{color_medium}_i}$) for the $i$th observation:

$$
log(\lambda_i) = \beta_0 + \beta_1 X_{\texttt{width}_i} + \beta_2 X_{\texttt{color_darker}_i} + \beta_3 X_{\texttt{color_light}_i} + \beta_4 X_{\texttt{color_medium}_i}.
$$

Note that the ordinal input `color` has four levels (where `dark` is the baseline): 
<!-- #endregion -->

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'ef6561481dd7f355a99408c62d1dcd9a', 'grade': False, 'grade_id': 'cell-a5c51d7457cd83a8', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
levels(crabs$color)
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "9f11986d9d874da9b2c6d7a4a127d49d", "grade": false, "grade_id": "cell-3474c3e0f1563e34", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
Therefore, we have three dummy variables: $X_{\texttt{color_darker}_i}$, $X_{\texttt{color_light}_i}$, and $X_{\texttt{color_medium}_i}$. Depending on the `color`, these dummy variables take on the following values:

- When `color` is `darker`, then $X_{\texttt{color_darker}_i} = 1$ while the other two dummy variables $X_{\texttt{color_light}_i} = X_{\texttt{color_medium}_i} = 0$.
- When `color` is `light`, then $X_{\texttt{light}_i} = 1$ while the other two dummy variables $X_{\texttt{color_darker}_i} = X_{\texttt{color_medium}_i} = 0$.
- When `color` is `medium`, then $X_{\texttt{medium}_i} = 1$ while the other two dummy variables $X_{\texttt{color_darker}_i} = X_{\texttt{color_light}_i} = 0$.

Call the model `crabs_Poisson_model`.
    
*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*    
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '0c23fb53ad786e0805a83daabc30eb8a', 'grade': False, 'grade_id': 'cell-cce6669279499835', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# crabs_Poisson_model <- ...(
#   ...,
#   ...,
#   ...
# )

# your code here
crabs_Poisson_model <- glm(
  formula = n_males ~ width + color,
  data = crabs,
  family = poisson
)


summary(crabs_Poisson_model)
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '01ca38e188374d6711e79151a5fec892', 'grade': True, 'grade_id': 'cell-97cc9b41beb464bf', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.6()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "a275f0f6e422f602fbd0bcfa871d3289", "grade": false, "grade_id": "cell-b7f592bf64da6cf8", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.7**
<br>{points: 1}

Report the estimated coefficients, their standard errors, and corresponding $p$-values using `tidy()` with `crabs_Poisson_model`. Include the corresponding asymptotic 95% confidence intervals. Store the results in the variable `crabs_Poisson_model_results`.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'b8ee3cebef5e66c1989656ce43ab8951', 'grade': False, 'grade_id': 'cell-4deafdcc73d1ddc4', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# crabs_Poisson_model_results <- 
#   ...(..., conf.int = TRUE) %>%
#   mutate_if(is.numeric, round, 3)

# your code here
crabs_Poisson_model_results <- 
  tidy(crabs_Poisson_model, conf.int = TRUE) %>%
  mutate_if(is.numeric, round, 3)

crabs_Poisson_model_results
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '338e86ff29326cb30c941ede1a46255c', 'grade': True, 'grade_id': 'cell-441e381e29ca858b', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.7()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "a9c205d86ae2d22d334014e8ae098f8b", "grade": false, "grade_id": "cell-f95b8a861b29b15b", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.8**
<br>{points: 1}

Since the link function is logarithmic, we can also interpret the exponentiated coefficients. Add to `crabs_Poisson_model_results` the estimate, and 95% confidence interval, of $e^{\beta_j}, j=0,...,p$. 

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '4ae1de2b5efd7ca21e55ad9390c55f1b', 'grade': False, 'grade_id': 'cell-faa353ab9211c114', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# crabs_Poisson_model_results <- 
#   crabs_Poisson_model_results %>%
#   mutate(
#     exp.estimate = ...,
#     exp.conf.low = ...,
#     exp.conf.high = ...) %>%
#   mutate_if(is.numeric, round, 4)

# your code here
# crabs_Poisson_model_results <- 
  crabs_Poisson_model_results %>%
  mutate(
    exp.estimate = exp(estimate),
    exp.conf.low = exp(conf.low),
    exp.conf.high = exp(conf.high)) %>%
  mutate_if(is.numeric, round, 4)


crabs_Poisson_model_results

```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'a615caefcc12fee9864b794e383c0a3d', 'grade': True, 'grade_id': 'cell-1822a6990bcbbd0f', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.8()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "7a2c5ac3641b01bf800bd44b047d7fdc", "grade": false, "grade_id": "cell-d029850491a79223", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
Note that you can also get the exponentiated estimated coefficients using `tidy` when the link function is `log` or `logit`. Note that `std.error` and `statistic` are not adjusted and it does not report the raw coefficients.
<!-- #endregion -->

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '72d9f39879dae06280ccf6b1d8876395', 'grade': False, 'grade_id': 'cell-d41aa0a8719a312b', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
tidy(crabs_Poisson_model, exponentiate = FALSE,conf.int = TRUE)
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '44c3dd5dd57ecf3fa13ce816a7cac29e', 'grade': False, 'grade_id': 'cell-87f78f36becf5ba3', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
tidy(crabs_Poisson_model, exponentiate = TRUE,conf.int = TRUE)
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "2f9677618f8b5a521ccf7c8e681f0609", "grade": false, "grade_id": "cell-7c2691fb066e9a1e", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.9**
<br>{points: 1}

Using a **significance level $\alpha = 0.05$**, and the output in `crabs_Poisson_model_results`, which of the following statements is TRUE?

**A.** There's enough evidence to reject the null hypothesis that the coefficient of carapace `width` is zero.

**B.** There's enough evidence to reject the null hypothesis that, for any width, the mean numbers of male crabs with `dark` and `darker` colors of the prosoma are equal.

**C.** There's enough evidence to reject the null hypothesis that, for any width, the mean numbers of male crabs with `dark` and `light` colors of the prosoma are equal. 

**D.** There's enough evidence to reject the null hypothesis that, for any width, the mean numbers of male crabs with `dark` and `medium` colors of the prosoma are equal.  

*Assign your answers to the object `answer1.9`. Your answers have to be included in a single string indicating the correct options **in alphabetical order** and surrounded by quotes (e.g., `"ABCD"` indicates you are selecting the four options).*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'd65d30b90231faecc44c6d528236c653', 'grade': False, 'grade_id': 'cell-d1466876e62cbd8d', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer1.9 <- 

# your code here
answer1.9 <- "ACD"

answer1.9
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '9a60387f4dcfb40d6906afa52ea7a93e', 'grade': True, 'grade_id': 'cell-c4b2bdbb07660385', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.9()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "2bfbb69a735c6be77b3a76f62ea9b164", "grade": false, "grade_id": "cell-3cce4716202a3ac2", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Interpretation of estimated coefficients for continuous covariates** 

Firstly, let us focus on the coefficient interpretation corresponding to carapace `width`, *while keeping `color` constant*. Consider an observation with a given value $X_{\texttt{width}} = \texttt{w}$ cm, and another observation with a given $X_{\texttt{width + 1}} = \texttt{w} + 1$ cm (i.e., an increase of $1$ cm). Then we have their corresponding regression equations:

$$
\log \lambda_{\texttt{width}} = \beta_0 + \beta_1 \overbrace{\texttt{w}}^{X_{\texttt{width}}} + \overbrace{\beta_2 X_{\texttt{color_darker}} + \beta_3 X_{\texttt{color_light}} + \beta_4 X_{\texttt{color_medium}}}^{\text{Constant}}
$$
$$
\log \lambda_{\texttt{width + 1}} = \beta_0 + \beta_1 \underbrace{(\texttt{w} + 1)}_{X_{\texttt{width + 1}}} + \underbrace{\beta_2 X_{\texttt{color_darker}} + \beta_3 X_{\texttt{color_light}} + \beta_4 X_{\texttt{color_medium}}.}_{\text{Constant}}
$$

We take the difference between both equations as:

\begin{align*}
\log \lambda_{\texttt{width + 1}} - \log \lambda_{\texttt{width}} &= \beta_1 (\texttt{w} + 1) - \beta_1 \texttt{w} \\
&= \beta_1.
\end{align*}

Then, we apply the logarithm property for a ratio:

\begin{align*}
\log \frac{\lambda_{\texttt{width + 1}} }{\lambda_{\texttt{width}}} &= \log \lambda_{\texttt{width + 1}} - \log \lambda_{\texttt{width}} \\
&= \beta_1.
\end{align*}

Finally, we have to exponentiate the previous equation:

$$
\frac{\lambda_{\texttt{width + 1}} }{\lambda_{\texttt{width}}} = e^{\beta_1}.
$$

This expression indicates that the mean count varies in a multiplicative way when a continuous covariate increases by 1 unit, i.e., $\lambda_{\texttt{width + 1}}= e^{\beta_1}\lambda_{\texttt{width}}$.
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "d18dc4097eb487b67385f4107bf2cafc", "grade": false, "grade_id": "cell-30680ad0b12b005a", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.10**
<br>{points: 1}

**Using the column `exp.estimate` from `crabs_Poisson_model_results`**, what is the correct interpretation of the regression equation's estimated slope for `width`?

**A.** The mean count of male crabs (`n_males`) around a female breeding nest decreases by $161\%$ when increasing the carapace `width` by $1$ cm, *while keeping `color` constant*.

**B.** The mean count of male crabs (`n_males`) around a female breeding nest increases by $161\%$ when increasing the carapace `width` by $1$ cm, *while keeping `color` constant*.

**C.** The mean count of male crabs (`n_males`) around a female breeding nest increases by $16.1\%$ when increasing the carapace `width` by $1$ cm, *while keeping `color` constant*.

**D.** The mean count of male crabs (`n_males`) around a female breeding nest decreases by $16.1\%$ when increasing the carapace `width` by $1$ cm, *while keeping `color` constant*.

**E.** The mean count of *dark* male crabs (`n_males`) around a female breeding nest increases by $161\%$ when increasing the carapace `width` by $1$ cm.

**F.** The mean count of *dark* male crabs (`n_males`) around a female breeding nest increases by $16.1\%$ when increasing the carapace `width` by $1$ cm.

*Assign your answer to the object `answer1.10`. Your answer should be one of `"A"`, `"B"`, `"C"`, `"D"`, `"E"`, or `"F"` surrounded by quotes.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '52bf049475f2209a74c35c60713d28d2', 'grade': False, 'grade_id': 'cell-813f996317ff61dd', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer1.10 <- ...

# your code here
answer1.10 <- "C"

answer1.10
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'f7233916807a2fc8edae2069861a8ade', 'grade': True, 'grade_id': 'cell-01b57f216ff8f262', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.10()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "f52d9e399a01697d185382fab3d2c8e2", "grade": false, "grade_id": "cell-01590258a807acee", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Interpretation of estimated coefficients of dummy variables** 

*Keeping `width` constant*, at any value (recall assumption of additive models!) consider an observation from the `darker` group: 

Then we have their corresponding regression equations:

$$
\log \lambda_{\texttt{width}} = \beta_0 + \beta_1 \overbrace{\texttt{w}}^{\text{Constant}} + \beta_2 X_{\texttt{color_darker}} + \beta_3 X_{\texttt{color_light}} + \beta_4 X_{\texttt{color_medium}}
$$

$$
\log \lambda_{\texttt{width,dark}} = \beta_0 + \beta_1 \texttt{w} + \beta_2 \times 0  + \beta_3 \times 0  + \beta_4 \times 0 
$$

$$
\log \lambda_{\texttt{width,darker}} = \beta_0 + \beta_1 \texttt{w} + \beta_2 \times 1 + \beta_3 \times 0 + \beta_4 \times 0.
$$

We take the difference between both equations as:

\begin{align*}
\log \lambda_{\texttt{width,darker}} - \log \lambda_{\texttt{width,dark}} = \beta_2.
\end{align*}

Then, we apply the logarithm property for a ratio:

\begin{align*}
\log \frac{\lambda_{\texttt{width,darker}} }{\lambda_{\texttt{width,dark}}} &= \log \lambda_{\texttt{width,darker}} - \log \lambda_{\texttt{width,dark}} \\
&= \beta_2.
\end{align*}

Finally, we have to exponentiate the previous equation:

$$
\frac{\lambda_{\texttt{width,darker}} }{\lambda_{\texttt{width,dark}}} = e^{\beta_2}.
$$

The expression $\frac{\lambda_{\texttt{width,darker}} }{\lambda_{\texttt{width,dark}}} = e^{\beta_2}$ indicates that the mean count changes in a multiplicative way between the two groups.
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "2730f7c988816ff03732f5225d70d2eb", "grade": false, "grade_id": "cell-f8af88cea66668b0", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.11**
<br>{points: 1}

Let us move on to the interpretation of the coefficient corresponding to `light` from `color` (with reference level `dark`).

Using the `crabs_Poisson_model_results` tibble, what is the correct interpretation of the regression estimated coefficient for the dummy variable `light`?

**A.** The mean count of male crabs (`n_males`) around a female breeding nest is $54.7\%$ lower in the  `light` prosoma group compared to `dark` group, *while keeping the carapace `width` constant (for any width value).*

**B.** The mean count of male crabs (`n_males`) around a female breeding nest $54.7\%$ higher in the  `light` prosoma group compared to `dark` group, *while keeping the carapace `width` constant (for any width value).*

**C.** The mean count of male crabs (`n_males`) around a female breeding nest $154.7\%$ higher in the  `light` prosoma group compared to `dark` group, *while keeping the carapace `width` constant (for any width value).*

**D.** The mean count of male crabs (`n_males`) around a female breeding nest $154.7\%$ lower in the  `light` prosoma group compared to `dark` group, *while keeping the carapace `width` constant (for any width value).*

**E.** The mean count of male crabs (`n_males`) around a female breeding nest is $54.7\%$ lower in the  `dark` prosoma group compared to `light` group, *while keeping the carapace `width` constant (for any width value).*

**F.** The mean count of male crabs (`n_males`) around a female breeding nest $54.7\%$ higher in the  `dark` prosoma group compared to `light` group, *while keeping the carapace `width` constant (for any width value).*

*Assign your answer to the object `answer1.11`. Your answer should be one of `"A"`, `"B"`, `"C"`, `"D"`, `"E"`, or `"F"` surrounded by quotes.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'ff760b89269d4912c27982a3fa0e2af6', 'grade': False, 'grade_id': 'cell-9dd1384a6af3a36a', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer1.11 <- ...

# your code here
answer1.11 <- "B"

answer1.11
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'd9edace5350e6c726a32663d2322356c', 'grade': True, 'grade_id': 'cell-27d30eed0b7b8bae', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.11()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "0ebd56f5239783cd05b4b3d5763e2d14", "grade": false, "grade_id": "cell-96565a64571f2a45", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.12**
<br>{points: 1}

Suppose we want to predict the mean count of male crabs (`n_males`) around a female breeding nest with a carapace `width` of $27.5$ cm and a `light` `color` of the prosoma. Then, using the function `predict()` with the object `crabs_Poisson_model`, obtain the corresponding prediction.

> **Hint:** Check the argument `type` when coding this prediction.

*Assign your answer to the object `answer1.12`. Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'e495e0ababf6655472414e9b0822ac7a', 'grade': False, 'grade_id': 'cell-5f4ccaec6bf73492', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer1.12 <- 
#   ...(...,
#     tibble(..., ..., ...),
#     type = ...
#   )

# your code here
answer1.12 <- 
  predict(crabs_Poisson_model,
    tibble(width = 27.5, color = "light"),
    type = "response"
  )


answer1.12
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '81c218f35362c5b32755ab5d436812c3', 'grade': True, 'grade_id': 'cell-0df8c510b063bb57', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.12()
```

```{r}

```
