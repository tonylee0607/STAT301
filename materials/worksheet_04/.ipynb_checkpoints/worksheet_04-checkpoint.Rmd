---
jupyter:
  jupytext:
    formats: ipynb,Rmd
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.16.0
  kernelspec:
    display_name: R
    language: R
    name: ir
---

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "2bc0ab1d62a0ed56ab2ad3c13fdcba23", "grade": false, "grade_id": "cell-f1e1d845873036f4", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
# Worksheet 4: Different Types of Input Variables and Interactions
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "2330c49b79d97925eb3fd19dbc44f3f3", "grade": false, "grade_id": "cell-da4f21ec759fe7cc", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
# Multiple Linear Regression (MLR)

This week we are going to "unleash" the scope of linear regression models and use them to study the association between a continuous response and *many* input variables of *different types*!! 

A linear regression model with many input variables is usually called a **Multiple Linear Regression (MLR)**. We will present models with:

- Continuous and categorical input variables


- Additive models and models with interaction terms
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "f512f82d019d4de9e295d1a863b15b65", "grade": false, "grade_id": "cell-82d9926086d47a80", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
# Learning Objectives:

After completing this week's lecture and tutorial work, you will be able to:

1. Give an example of a real problem that could be answered by a multiple linear regression.

2. Interpret the coefficients and p-values of different types of input variables, including categorical input variables.

3. Define interactions in the context of linear regression.

4. Write a computer script to perform linear regression when input variables are continuous or discrete, and when there are interactions between some of these variables.
<!-- #endregion -->

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'fb02d85f5dd3448c17ba0b8277d7d7b4', 'grade': False, 'grade_id': 'cell-a2a153352bc44a68', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
# Run this cell before continuing.
library(tidyverse)
library(repr)
library(infer)
library(cowplot)
library(broom)
library(GGally)
source("tests_worksheet_04.R")
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "7156831e68bec6004bb333f5008386b2", "grade": false, "grade_id": "cell-ee52500a6f5e8006", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
# PART I
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "79fbf9bcdfb73066c212dea24d2f8b27", "grade": false, "grade_id": "cell-e9b0c70835891fa8", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
## 1. MLR: additive models with continuous input variables

In this section, we will continue working with the dataset `US_cancer_data` introduced in `worksheet_03`. You noticed that there exists a positive association between mortality rates (measured by `TARGET_deathRate`) and the percentage of the county's populace in poverty (measured by `povertyPercent`).

However, there may be other variables associated with mortality. Let's start by visualizing again the relationship between the variables in our data using the plotting function `ggpairs()`, from the library `GGally`. The `ggplot()` object's name will be `US_cancer_data_pairplots`.
<!-- #endregion -->

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'dfd69f2e8ab631368286743abff1ddcf', 'grade': False, 'grade_id': 'cell-14bec94f435065b2', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
US_cancer_data <- read_csv("data/US_county_cancer_data.csv") %>%
  select(TARGET_deathRate, povertyPercent, PctPrivateCoverage)
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'd1c25fbd01604d371ee4d3cf075f1f35', 'grade': False, 'grade_id': 'cell-4bfbcd7bf2300890', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
US_cancer_data_pairplots <- US_cancer_data %>%
  ggpairs(progress = FALSE) +
  theme(
    text = element_text(size = 15),
    plot.title = element_text(face = "bold"),
    axis.title = element_text(face = "bold")
  )
US_cancer_data_pairplots
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "04922f968f08934e2af58fe8ab79a54b", "grade": false, "grade_id": "cell-fec7f6f2d3be53a5", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### <font color="blue">Should we study the relation of the response with input variables separately or jointly using linear regressions? </font>
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "0be8281f0267ec0c41e9297818e51221", "grade": false, "grade_id": "cell-999efddaa87f6e21", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
### R Code

In R, you can add input variables in the RHS of the formula with signs `+` or `*`, depending on the assumptions made. For example, in an **additive model**, variables are added to the model using `+`. If you want to model interactions between variables you use `*`.

`MLR_poverty_coverage_add <- lm(TARGET_deathRate ~ povertyPercent + PctPrivateCoverage, data = US_cancer_data)`
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "5079477b9048eb8aecebe119cb533be4", "grade": false, "grade_id": "cell-f2341623cf23ea5f", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.0**
<br>{points: 2}

Using the dataset `US_cancer_data` fit the following 3 models:

**A.** A SLR with `TARGET_deathRate` as the response and `povertyPercent` as a single input variable. Call this model `SLR_poverty`

**B.** A SLR with `TARGET_deathRate` as the response and `PctPrivateCoverage` as a single input variable. Call this model `SLR_coverage`

**C.** An additive MLR with `TARGET_deathRate` as the response and `povertyPercent` and `PctPrivateCoverage` as input variables. Call this model `MLR_poverty_coverage`

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '74c0112856209f790d2d14afa7a41244', 'grade': False, 'grade_id': 'cell-6c3053af7bc15cf8', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# Model A 
# SLR_poverty <- ...(..., ...)
# SLR_poverty

# Model B
# SLR_coverage <- ...(..., ...)
# SLR_coverage

# Model C
# MLR_poverty_coverage <- ...(..., ...)
# MLR_poverty_coverage

# your code here
# Model A 
SLR_poverty <- lm(TARGET_deathRate ~ povertyPercent, data = US_cancer_data)
SLR_poverty

# Model B
SLR_coverage <- lm(TARGET_deathRate ~ PctPrivateCoverage, data = US_cancer_data)
SLR_coverage

# Model C
MLR_poverty_coverage <- lm(TARGET_deathRate ~ povertyPercent + PctPrivateCoverage, data = US_cancer_data)
MLR_poverty_coverage
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'abc457f5b02a04a7867466d6b15a9687', 'grade': True, 'grade_id': 'cell-e5e9619068ec6fc6', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.0.0()
test_1.0.1()
test_1.0.2()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "25b712a92432d7e2fac9dcebfece9bf4", "grade": false, "grade_id": "cell-1c263f0fea96650d", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.1**
<br>{points: 1}

Use `tidy` and manipulate the output to obtain the estimated coefficients of the variable `PctPrivateCoverage` in models **B** and **C**, respectively. Assign your answer to an object called `SLR_coverage_coef` and `MLR_coverage_coef`, respectively.

*Fill out those parts indicated with ..., uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '9f8bf3ce001772f520bb9f4152d68376', 'grade': False, 'grade_id': 'cell-c3a6ef315856d940', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
#SLR_coverage_coef <- tidy(...) %>% mutate_if(is.numeric, round, 2) %>% 
#                        subset(term == "...")  %>% pull(...)
#SLR_coverage_coef

#MLR_coverage_coef <- tidy(MLR_cancer_poverty_coverage) %>% mutate_if(is.numeric, round, 2) %>% 
#                        subset(term == "...")  %>% pull(...)
#MLR_coverage_coef



# your code here
SLR_coverage_coef <- tidy(SLR_coverage) %>% mutate_if(is.numeric, round, 2) %>% 
                       subset(term == "PctPrivateCoverage")  %>% pull(estimate)
SLR_coverage_coef

MLR_coverage_coef <- tidy(MLR_poverty_coverage) %>% mutate_if(is.numeric, round, 2) %>% 
                       subset(term == "PctPrivateCoverage")  %>% pull(estimate)
MLR_coverage_coef
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '78c64af1dcb4e53ea14b516de13cd9ea', 'grade': True, 'grade_id': 'cell-e8cf16dd75d1fe83', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.1.0()
test_1.1.1()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "362a059678eadc7ee5a0a6524e4ea7d4", "grade": false, "grade_id": "cell-e0d1e9302b5ffd5d", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
The results from **Question 1.1** show that the estimated relation between `TARGET_deathRate` and `PctPrivateCoverage` is ***not*** the same in both models. 

#### But why??

- **In the MLR**, the coefficient of `PctPrivateCoverage` models the relation between `TARGET_deathRate` and `PctPrivateCoverage` *for any fix percentage of populace in poverty*.


- **In the SLR**, the variable `povertyPercent` is not even in the model!! Thus, the variation in mortality due to this variable is part of the error term, together with many other variables that may be related with mortality!!

Keeping these observations in mind, distinguish between the following interpretations:
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "4cab06206d107b19ccb312a99d52bd2e", "grade": false, "grade_id": "cell-4166a7b5a8dd3e4f", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.2**
<br>{points: 1}

Use the estimates from **Question 1.1** to complete the following interpretations:

1. ***On average***, the expected cancer mortality per capita is related with a `answer1.2.0` (cases/100,000) change for every 1 percent increase percentage of county residents with private health coverage. 


2. ***At any fix percentage of populace in poverty***, the expected cancer mortality per capita is related with a `answer1.2.1` (cases/100,000) change for every 1 percent increase percentage of county residents with private health coverage.


*Assign your answers to the objects `answer1.2.0` and `answer1.2.1` (numeric type).* 

**Tip: Your answers should be the names of the objects used to store the estimates in the previous question**
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '56ac45cde14c95b07816df0860abcec8', 'grade': False, 'grade_id': 'cell-1f531a6a33ef6231', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer1.2.0 <- ...
#answer1.2.0

# answer1.2.1 <- ...
#answer1.2.1

# your code here
answer1.2.0 <- SLR_coverage_coef
answer1.2.0

answer1.2.1 <- MLR_coverage_coef
answer1.2.1
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '1a73ed9bbbea62c3b46daefb083b1968', 'grade': True, 'grade_id': 'cell-ab9a7716b0d70932', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.2.0()
test_1.2.1()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "be3ad6a71ffd5dcbc849be2ea3a439c1", "grade": false, "grade_id": "cell-1d29345fdfe81eac", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.3**
<br>{points: 1}

As we have learned for SLRs, `lm` uses some theoretical results to measure the sample-to-sample variation of the estimators. The same is true for the estimators of MLR coefficients! 

Use `tidy` to obtain the standard errors, statistics, and p-values for the coefficients of `MLR_poverty_coverage` model which are needed to perform statistical hypothesis tests. 

Store them in the variable `MLR_poverty_coverage_results`.

*Fill out those parts indicated with ..., uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'ffccbd48a3c978ef1cafd0ce2cf2dab5', 'grade': False, 'grade_id': 'cell-4caa40aab9d5f472', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# MLR_poverty_coverage_results <- ...(...) %>% mutate_if(is.numeric, round, 2)
# MLR_poverty_coverage_results

# your code here
MLR_poverty_coverage_results <- tidy(MLR_poverty_coverage) %>% mutate_if(is.numeric, round, 2)
MLR_poverty_coverage_results


```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '8a9dbbca0467f16b60e4664da8ecb436', 'grade': True, 'grade_id': 'cell-669d1af7dbfd9ed2', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.3()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "4aceee0210fb3dcf968f12b06505c53e", "grade": false, "grade_id": "cell-8bdff6da17cfb4e7", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 1.4**
<br>{points: 1}

Based on the output stored in `MLR_poverty_coverage_results` with a significance level $\alpha = 0.05$, in plain words, what is the conclusion of the hypothesis testing for the association between mortality and the percentage of county residents with private health coverage?

**A.** We reject the null hypothesis; thus, holding the county's populace in poverty constant, the percentage of county residents with private health coverage has a statistically significant effect on the county's cancer mortality per capita (cases/100,000).

**B.** We fail to reject the null hypothesis; thus, holding the county's populace in poverty constant, the percentage of county residents with private health coverage does not have a statistically significant effect on the county's cancer mortality per capita (cases/100,000).

**C.** We fail to reject the null hypothesis; thus, holding the county's populace in poverty constant, the percentage of county residents with private health coverage is not statistically associated with the county's cancer mortality per capita (cases/100,000).

**D.** We reject the null hypothesis; thus, holding the county's populace in poverty constant, the percentage of county residents with private health coverage is statistically associated with the county's cancer mortality per capita (cases/100,000).


*Assign your answer to an object called `answer1.4`. Your answer should be one of `"A"`, `"B"`, `"C"`, or `"D"` surrounded by quotes.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '43d787e9da21bcdb4920240a74123b76', 'grade': False, 'grade_id': 'cell-a3da1cb1cf749dab', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer1.4 <- 

# your code here
answer1.4 <- "D"
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'eaa9fef8b213fd86312c4a43f84f9fc2', 'grade': True, 'grade_id': 'cell-9439f55a394cc7d8', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_1.4()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "d131a8c20f2f36f1ce09c87a622a3604", "grade": false, "grade_id": "cell-d03e76b877e96808", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### <font color="blue"> MLR *simultaneously* models the association of multiple predictors with the response

In additive models:

- we assume that the association between each input and the response does *not* vary across values of other variables
    
    
- each estimate is interpreted as the association of the input variable with the response, keeping all other input variables constant (at any value)!! 
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "82f57cb561e937911cb5240ac41ecfae", "grade": false, "grade_id": "cell-2d1ba07bb9b4b1f0", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
## 2. Categorical input variables with 2 or more levels

In STAT 201 and in week 2, we used statistical tools to examine if population quantities differ among different groups.

- For example: does the average size donation depend on a website version (with 2 or more variations of it)?

Note that even in those cases we are examining the association between 2 variables

- In the example above: `donation` (in $) *vs* `website version` (with levels A and B)  

#### Can we use linear regression to answer to compare population quantities from different groups??

Let's use the `US_cancer_data` to explore if the cancer mortality differ by states. 

> Note: the original `US_county_cancer_data` does not contain a specific column for the state where each county belongs, so we'll get that information from the variable `Geography` using code to split strings.

Let's start by comparing the mortality rates in 2 states: *Alabama* vs *California*. 
<!-- #endregion -->

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '74e6b455cb2bb37522603223bf96c57a', 'grade': False, 'grade_id': 'cell-7e42615a46c8b5b9', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
US_cancer_data <- read_csv("data/US_county_cancer_data.csv") %>%
  select(TARGET_deathRate, povertyPercent, PctPrivateCoverage, Geography)

US_cancer_data$state <- sapply(strsplit(US_cancer_data$Geography, ", "), "[", 2)  
                            
head(US_cancer_data,3)

str(US_cancer_data)
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '9c76ac6fdc89c7f2efdfd535db216ac1', 'grade': False, 'grade_id': 'cell-6dd23eb9cc946271', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
AC_cancer_data <- US_cancer_data %>%filter(state %in% c("California", "Alabama"))%>% 
                            droplevels()

AC_cancer_data$state <- as.factor(AC_cancer_data$state)

str(AC_cancer_data)
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "1166f41345c04c37c24070f048da02d9", "grade": false, "grade_id": "cell-15aa0f5be3b0c198", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 2.0**
<br>{points: 1}

Let's start by graphically compare the distributions and spread of mortality rates in both states. We will use side-by-side boxplots. The `ggplot()` object's name will be `TARGET_deathRate_boxplots`. 

> Note that function `stat_summary()` will be needed to add the average mortality rates in each state as points on top of each boxplot.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '6dba4c0105574c927bddc9a9efe34dde', 'grade': False, 'grade_id': 'cell-71bef695d66fdf12', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
options(repr.plot.width = 15, repr.plot.height = 7) # Adjust these numbers so the plot looks good in your desktop.

# TARGET_deathRate_boxplots <- ... %>%
#   ggplot() +
#   ...(aes(..., ..., fill = ...)) +
#   theme(
#     text = element_text(size = 18),
#     plot.title = element_text(face = "bold"),
#     axis.title = element_text(face = "bold")
#   ) +
#   ggtitle(...) +
#   xlab(...) +
#   ylab(...) +
#   stat_summary(aes(..., ..., fill = ...),
#     fun = ..., colour = "yellow", geom = "point",
#     shape = 18, size = 5
#   )

# TARGET_deathRate_boxplots

# your code here
TARGET_deathRate_boxplots <- AC_cancer_data %>%
  ggplot() +
  geom_boxplot(aes(state, TARGET_deathRate, fill = state)) +
  theme(
    text = element_text(size = 18),
    plot.title = element_text(face = "bold"),
    axis.title = element_text(face = "bold")
  ) +
  ggtitle("Mortality Rate by State") +
  xlab("State") +
  ylab("Mortality Rate") +
  stat_summary(aes(state, TARGET_deathRate, fill = state),
    fun = mean, colour = "yellow", geom = "point",
    shape = 18, size = 5
  )

TARGET_deathRate_boxplots
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '340e4b1068d8b4415dfc1bc471ca9c0d', 'grade': True, 'grade_id': 'cell-0c392b9d7ff9ff85', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_2.0()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "615df3592e7404bf81b7c904607e9935", "grade": false, "grade_id": "cell-04cf4b926da687d8", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
The side-by-side boxplots in `TARGET_deathRate_boxplots` show some differences in mortality rates between both states. Let's use data, and a linear regression to estimate the relationship between these variables and test this hypothesis!!

#### How can we include a categorical variable in a mathematical equation??
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "fa12abf5a16f08e63f0ca34fcc18b84f", "grade": false, "grade_id": "cell-fdf0edc709accccf", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
Note that this is like having 2 LR in one:

- For counties in Alabama, $X_i=0$, then $Y_i = \beta_0 + \beta_1 \times 0 + \varepsilon_i = \beta_0 + \varepsilon_i$


- For counties in California, $X_i=1$, then $Y_i = \beta_0 + \beta_1 \times 1 + \varepsilon_i = \beta_0 + \beta_1 + \varepsilon_i$


Then,


- For counties in Alabama, $X_i=0$, $E[Y_i|X_i=0] = \beta_0$


- For counties in California, $X_i=1$, $E[Y_i|X_i=1] = \beta_0 + \beta_1$



<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "127e7711ca96dbff98505233a0b01045", "grade": false, "grade_id": "cell-6a6cfab503bd4bcd", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
### R Code

R creates special numerical variables for you, called dummy variables, to include in the model if you indicate that the input variable (in our case `state`) is a *factor*!! For example, 

`AC_data_LR <- lm(TARGET_deathRate ~ state, data = AC_cancer_data)`

If `state` is a factor, R creates a dummy variables to estimate the model:

- `R` calls the dummy variable `stateCalifornia` (name of the variable followed by the level corresponding to 1)


- The reference level (dummy variable = 0, level "left out") is "Alabama", chosen alphabetically.

#### Important: Note that there's not a *line* in this case!! We can still call it a "linear regression" because the model is a linear combination of variables! 
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "f54139b3e8d4304cf644235c138a0c16", "grade": false, "grade_id": "cell-7dd6ff8b03ac703f", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 2.1**
<br>{points: 1}

Using `AC_cancer_data`, use a LR to estimate the relation between `TARGET_deathRate` and `state` and assign it to the object `AC_data_LR`.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '41fd1c7de3e1cb997e160a488dc9452d', 'grade': False, 'grade_id': 'cell-ac71cc4d1135a313', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# AC_data_LR <- ...(...,
#   ...
# )
# AC_data_LR

# your code here
AC_data_LR <- lm(TARGET_deathRate ~ state,
  data = AC_cancer_data
)
AC_data_LR
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '44c4da1df28d3bffa13ba40a0b65fa14', 'grade': True, 'grade_id': 'cell-2b958124fea93936', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_2.1.0()
test_2.1.1()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "abe1288ccbdd0e93cdb009729ca55122", "grade": false, "grade_id": "cell-72a6a5135ffaaf3b", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 2.2**
<br>{points: 1}

Find the estimated coefficients of `AC_data_LR` using `tidy()`. Report the estimated coefficients, their standard errors, and corresponding $p$-values. Include the corresponding asymptotic 95% confidence intervals. 

Store the results in the variable `AC_data_LR_results`.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '8eb80ee8655f56381e40572c45daf71a', 'grade': False, 'grade_id': 'cell-9294e9ba8d1b9394', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# AC_data_LR_results <- ...(..., ...) %>% mutate_if(is.numeric, round, 2)
# AC_data_LR_results

# your code here
AC_data_LR_results <- tidy(AC_data_LR, conf.int = TRUE) %>% mutate_if(is.numeric, round, 2)
AC_data_LR_results
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '79c3ad1295454a0994b0e9076a32a108', 'grade': True, 'grade_id': 'cell-57610c27ce370eb0', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_2.2()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "818f99bbeaa22528c90b656d15a2ee23", "grade": false, "grade_id": "cell-349903d046e57131", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 2.3**
<br>{points: 1}

Recall that we want to investigate if the expected mortality rates are statistically different between states. Hence, it will be necessary to perform a hypothesis testing on the regression coefficient corresponding to `state`. In plain words, the hypotheses ($H_0$ versus $H_1$) are the following:

$$H_0: \text{there is no difference in the expected mortality rates (means) between both states}$$
$$H_1: \text{there is a difference in the expected mortality rates (means) between both states}$$

What is the mathematical translation of these hypotheses?

**A.** $H_0: \beta_1 = 0$ vs. $H_1: \beta_1 > 0$

**B.** $H_0: \beta_0 = 0$ vs. $H_1: \beta_0 \neq 0$

**C.** $H_0: \beta_0 = 0$ vs. $H_1: \beta_0 > 0$

**D.** $H_0: \hat{\beta}_1$ = 0 vs. $H_1: \hat{\beta}_1 \neq 0$

**E.** $H_0: \hat{\beta}_0$ = 0 vs. $H_1: \hat{\beta}_0 > 0$

**F.** $H_0: \beta_1 = 0$ vs. $H_1: \beta_1 \neq 0$

*Assign your answer to an object called `answer2.3`. Your answer should be one of `"A"`, `"B"`, `"C"`, `"D"`, `"E"`, or `"F"` surrounded by quotes.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '42bf068382585eafc24c4ce06d1a89ee', 'grade': False, 'grade_id': 'cell-8ca28d9fe6e21a19', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer2.3 <- 

# your code here
answer2.3 <- "F"
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '801772c34d7a663b885f2087c4725227', 'grade': True, 'grade_id': 'cell-936e1a3537f9f0ab', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_2.3()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "a29162aabaa02e474358daaa2edc2d70", "grade": false, "grade_id": "cell-70ce39d223c56952", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 2.4**
<br>{points: 1}

Using the corresponding $p$-value stored in `AC_data_LR_results` and a **significance level $\alpha = 0.05$**, in plain words, what is the conclusion of the hypothesis test in **Question 2.3**?

**A.** We fail to reject the null hypothesis; thus, there is no statistically significant difference in the mortality rates between states.

**B.** We reject the alternative hypothesis; thus, there is no statistically significant difference in the average mortality rates between states.

**C.** We reject the null hypothesis; thus, there is a statistically significant difference in the average mortality rates between states.

*Assign your answer to an object called `answer2.4`. Your answer should be one of `"A"`, `"B"`, or `"C"`, surrounded by quotes.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'fa7fb29e168295ddd6199cdc43245fb9', 'grade': False, 'grade_id': 'cell-171580d19801a8fc', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer2.4 <- 

# your code here
answer2.4 <- "C"
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '06287bcb963506e246ba2839953b5f89', 'grade': True, 'grade_id': 'cell-838f7849134cd6fe', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_2.4()
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '6e0eaa93ff7e38e4c22cd8f6e98cbc19', 'grade': False, 'grade_id': 'cell-10025b2da2bab927', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
AC_data_LR_results
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "b81a657fb65d57d4ee6bd1912ea709f1", "grade": false, "grade_id": "cell-1e3ed8f6cfb8008d", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 2.5**
<br>{points: 1}


What is the correct interpretation of the estimated regression coefficient for the dummy variable `stateCalifornia`?

**A.** The average mortality rate in California is 34.63 (cases/100,000) below that of Alabama.

**B.** The average mortality rate in Alabama is 34.63 (cases/100,000) below that of California.

**C.** The average mortality rate in California is 34.63 (cases/100,000).


*Assign your answers to the object `answer2.5` (it should be one of `"A"`, `"B"`, or `"C"` surrounded by quotes).*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '2a48c749cc415b3f260d61ec5ddf9b43', 'grade': False, 'grade_id': 'cell-974569bc8b3b9f4d', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer2.5 <- ...

# your code here
answer2.5 <- "A"
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'df1fdf1894f620e99884f01a0442fda6', 'grade': True, 'grade_id': 'cell-689404c848bdbf57', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_2.5()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "d1c32793dee7c08ba41dc6752869172c", "grade": false, "grade_id": "cell-4a32c1f2fbee683c", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
### But wait: isn't this a 2-sample t-test??

> run the following cell and discuss results with your neighbour.
<!-- #endregion -->

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '1a03dc7e28424c29ed98fc8bc8cf1915', 'grade': False, 'grade_id': 'cell-00b0e2f481d93a54', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
t.test(TARGET_deathRate ~ state,AC_cancer_data,var.equal=T)
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "7aba354105fe9d5ad06f2483504b3a26", "grade": false, "grade_id": "cell-6d25c79cd467ed7a", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### This is not a coincidence! `lm` is running the *same* *t*-test!!
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "f0f8a1a2f48194f6edc95b9b81832c93", "grade": false, "grade_id": "cell-ecc1ba485f634be7", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
### Categorical variable with more than 2 levels¶

But what do we do if the categorical variable has more levels??!

We need additional dummy variables! Dummy variables are comparisons to a *reference* level. Thus, we need more of these variables to compare all other levels with respect to the reference.

Don't worry, R will create these variables (as long as the categorical variables is a factor).
<!-- #endregion -->

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '7833ed6d04f5c4a5dc0bee93ed8f8568', 'grade': False, 'grade_id': 'cell-9f33651d68c60288', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
ACK_cancer_data <- US_cancer_data %>%filter(state %in% c("California", "Alabama", "Kansas"))%>% 
                            droplevels()

ACK_cancer_data$state <- as.factor(ACK_cancer_data$state)
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '77f3c01567a01774b8fc0a1206c3d494', 'grade': False, 'grade_id': 'cell-d1b3a92b37895e76', 'locked': True, 'schema_version': 3, 'solution': False, 'task': False}}
ACK_data_LR <- tidy(lm(TARGET_deathRate ~ state,
                  data = ACK_cancer_data))  %>% mutate_if(is.numeric, round, 3)
ACK_data_LR
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "914c3e1abf7465af3536a2b0c9762757", "grade": false, "grade_id": "cell-afdd9961cbbef389", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### <font color="blue"> Categorical variables can be included in a LR using dummy variables

Dummy variables:

- R creates them for all factors in the model
    
    
- (by default) a reference level is chosen alphabetically 
    

- levels of a categorical variable are compared to the reference level!! 
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "0786121535bb4404e0b7975b7a76426e", "grade": false, "grade_id": "cell-85f6b5d9210bc0ab", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
# PART II
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "6c482153f69501853c05c64642125ea5", "grade": false, "grade_id": "cell-b0786b1179eeda7a", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
## 3. MLR: additive model with one continuous and one categorical variable
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "fb60b9630053734a070a72db896bf56a", "grade": false, "grade_id": "cell-b4095171532c8b1f", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 3.0**
<br>{points: 1}

Use the data to estimate this additive model. Report the estimated coefficients, their standard errors, and corresponding $p$-values using `tidy()`. Include the corresponding asymptotic 95% confidence intervals. 

Store the results in the variable `MLR_state_poverty_add_results`.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'd096758ec617937c1e2325264875aefc', 'grade': False, 'grade_id': 'cell-2946a12265647212', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# MLR_state_poverty_add <- ...(...,
#   ...
# )
# MLR_state_poverty_add

# MLR_state_poverty_add_results <- ...(..., ...) %>% mutate_if(is.numeric, round, 2)
# MLR_state_poverty_add_results

# your code here
MLR_state_poverty_add <- lm(TARGET_deathRate ~ povertyPercent + state,
  data = AC_cancer_data
)
MLR_state_poverty_add

MLR_state_poverty_add_results <- tidy(MLR_state_poverty_add, conf.int = 0.95) %>% mutate_if(is.numeric, round, 2)
MLR_state_poverty_add_results


```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '8b0e71778b6718ad1cb938fa3f017253', 'grade': True, 'grade_id': 'cell-be7150262eba4cb3', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_3.0()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "17eaa2f3392450732a5fe925ffe7c6c6", "grade": false, "grade_id": "cell-ce31044ed34aab3c", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### NOTE: there are 3 coefficients for 2 lines because the additive model assumes a *common* slope!!
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "1d92b46244e484ad17cead8eeca110f4", "grade": false, "grade_id": "cell-1c26185c5851d59e", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 3.1**
<br>{points: 1}

Using a **significance level $\alpha = 0.10$**, and the results in `MLR_state_poverty_add_results`, which of the following interpretations is correct?

**A.** On average, the mortality rate in California is statistically different from that in Alabama.

**B.** On average, the mortality rate is statistically associated with poverty.

**C.** The association between mortality and poverty differs per state.

**D.** The expected mortality rate is the same in both states.

*Assign your answers to the object `answer3.1`. Your answers have to be included in a single string indicating the correct options **in alphabetical order** and surrounded by quotes (e.g., `"ABCD"` indicates you are selecting the four options).*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'd87904f248c77f3abf90406ab304f08c', 'grade': False, 'grade_id': 'cell-f85bb6f2a36d6aab', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer3.1 <- 

# your code here
answer3.1 <- "AB"
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '78dd30a634893c32e6da2275f84b6559', 'grade': True, 'grade_id': 'cell-4ec433c8a5e3feaf', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_3.1()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "329cc748aea31949bd9e0a2b25abd59f", "grade": false, "grade_id": "cell-b0cb1633a525c60a", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### **Question 3.2**
<br>{points: 1}

Create a plot of the data (using `geom_point()`) along with the estimated regression lines coming from the additive regression model `MLR_state_poverty_add` (note that your plot should have two regression lines, one for each state). 

- You have to colour the points and regression lines by state. 

- Include a legend indicating what colour corresponds to each state with proper axis labels. 

The `ggplot()` object's name will be `MLR_state_poverty_add_plot`.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'bb5cde60f4f8e3957d09661012daa9b8', 'grade': False, 'grade_id': 'cell-9e94dc68363dec56', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# AC_cancer_data$pred_MLR_add <- predict(MLR_state_poverty_add) # Using predict() to create estimated regression lines.

# MLR_state_poverty_add_plot <- ggplot(..., aes(
#   ...,
#   ...,
#   color = ...
# )) +
#   ...() +
#   geom_line(aes(y = pred_MLR_add), size = 1) +
#   labs(
#     title = ...,
#     x = ...,
#     y = ...
#   ) +
#   theme(
#     text = element_text(size = 16.5),
#     plot.title = element_text(face = "bold"),
#     axis.title = element_text(face = "bold"),
#     legend.title = element_text(face = "bold"),
#   ) +
#   labs(color = "State")
# MLR_state_poverty_add_plot

# your code here
AC_cancer_data$pred_MLR_add <- predict(MLR_state_poverty_add) # Using predict() to create estimated regression lines.

MLR_state_poverty_add_plot <- ggplot(AC_cancer_data, aes(
  povertyPercent,
  TARGET_deathRate,
  color = state
)) +
  geom_point() +
  geom_line(aes(y = pred_MLR_add), size = 1) +
  labs(
    title = "Relationship between Poverty Percent and Target Death Rate",
    x = "Poverty Percent",
    y = "Target Death Rate"
  ) +
  theme(
    text = element_text(size = 16.5),
    plot.title = element_text(face = "bold"),
    axis.title = element_text(face = "bold"),
    legend.title = element_text(face = "bold"),
  ) +
  labs(color = "State")
MLR_state_poverty_add_plot
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'e375c513022d23794b13f662bccd9a6e', 'grade': True, 'grade_id': 'cell-10b3b1d7e3b64d1d', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_3.2()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "e677f6b7da7320ddc557dea7bc6256e2", "grade": false, "grade_id": "cell-cef46ec1b084cec8", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### **Question 3.3**
<br>{points: 1}

Looking at the plot in **Question 3.2** and the modelling framework in **Question 3.0**, what is the fundamental assumption we are making when using an additive MLR with a mixture of continuous and categorical explanatory variables?

**A.** The regression lines for both states have different slopes relating poverty to average mortality.

**B.** The regression lines for both states have the same slopes relating poverty to average mortality, but different intercepts.

**C.** The regression lines for both states have different slopes and intercepts relating poverty to average mortality.

*Assign your answer to the object `answer3.3`. Your answer should be one of `"A"`, `"B"`, or `"C"` surrounded by quotes.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '3dbf3f5736cade464cc47fc198f89931', 'grade': False, 'grade_id': 'cell-1ea882444c1027f8', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer3.3 <- 

# your code here
answer3.3 <- "B"
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '09e91abd7503ae1bfdf1dc159d1cc505', 'grade': True, 'grade_id': 'cell-bc1ca9c4cb59a2ce', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_3.3()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "25aea8f83935551a36cf0914c00f88b3", "grade": false, "grade_id": "cell-a82b9b87faa8f123", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### <font color="blue"> An additive model with one continuous and one categorical input variable, has a common slope and different intercepts for each level of the categorical variable </font>  
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "bcb5f22681022c9c2781a2043827cf4d", "grade": false, "grade_id": "cell-c11b86226891397a", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
## 4. MLR: interaction between a continuous and a categorical variable
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "77c1bc52999779cb0340c85a75a87590", "grade": false, "grade_id": "cell-a206cc5c30a9f053", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
Now, estimate another MLR model called `MLR_state_poverty_int` but this time we do not assume that the association between mortality and poverty is the same in both states. 

> In other words, there may exist an *interaction* between the input variables.

#### <font color="blue">If the relation changes by the levels of the categorical variable, we need to add interaction term(s)</font>
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "3fe0118630efdde19b1925abd8eadad5", "grade": false, "grade_id": "cell-facaf3cc65b6e0be", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### **Question 4.0**
<br>{points: 1}

Use the data to estimate the new model with an interaction term. Report the estimated coefficients, their standard errors, and corresponding $p$-values using `tidy()`. Include the corresponding asymptotic 95% confidence intervals. Store the results in the variable `MLR_state_poverty_int_results`.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'a90a4ffe2456eb0d50c33f4c59ba0741', 'grade': False, 'grade_id': 'cell-e2dfc93d5dcc3940', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# MLR_state_poverty_int <- ...(...,
#   ...
# )
# MLR_state_poverty_int

# MLR_state_poverty_int_results <- ...(..., ...) %>% mutate_if(is.numeric, round, 2)
# MLR_state_poverty_int_results

# your code here
MLR_state_poverty_int <- lm(TARGET_deathRate ~ povertyPercent * state,
  data = AC_cancer_data
)
MLR_state_poverty_int

MLR_state_poverty_int_results <- tidy(MLR_state_poverty_int, conf.int = 0.95) %>% mutate_if(is.numeric, round, 2)
MLR_state_poverty_int_results


```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '228b99df5cc5cfb24c1d7f84acb0c5cb', 'grade': True, 'grade_id': 'cell-981315043633b23f', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_4.0()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "f0338e1b480abe86b19ae638864c898e", "grade": false, "grade_id": "cell-7db47d332e83d2b3", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### NOTE: there are now 4 coefficients for 2 lines because in the model with interactions we do *NOT* assume a common slope!!
<!-- #endregion -->

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "830b1705b3d2497ec90f92107feece33", "grade": false, "grade_id": "cell-fa10bf6e6ab8a06e", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 4.1**
<br>{points: 1}

Using a **significance level $\alpha = 0.10$**, and the results in `MLR_state_poverty_int_results`, which of the following interpretations is correct?

**A.** Mortality rates in Alabama are low.

**B.** The expected mortality rate does not differ by state.

**C.** In California, the expected change in mortality as poverty increases is higher than in Alabama.

**D.** In Alabama, the mortality rate is statistically associated with poverty.

**E.** The association between mortality and poverty varies (significantly) between Alabama and California.

**F.** The association between mortality and poverty is the same in Alabama and California.

*Assign your answers to the object `answer4.1`. Your answers have to be included in a single string indicating the correct options **in alphabetical order** and surrounded by quotes (e.g., `"ABCD"` indicates you are selecting the four options).*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '0cf020e93aeac369e24222bf547a369b', 'grade': False, 'grade_id': 'cell-3257b17772b64147', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer4.1 <- 

# your code here
answer4.1 <- "D"
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'a791437a1625a1bc330fd0b9add2de4b', 'grade': True, 'grade_id': 'cell-466c41ec1c2daeac', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_4.1()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "a9b555d0b42b3865bb9da9dda7df55ce", "grade": false, "grade_id": "cell-fac6de579f7aac57", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 4.2**
<br>{points: 1}

Create a plot of the data (using `geom_point()`) along with the estimated regression lines coming from the interaction regression model `MLR_state_poverty_int` (note that your plot should have two regression lines, oone for each state). 

- You have to colour the points and regression lines by state. 

- Include a legend indicating what colour corresponds to each state with proper axis labels. 

The `ggplot()` object's name will be `MLR_state_poverty_int_plot`.

*Fill out those parts indicated with `...`, uncomment the corresponding code in the cell below, and run it.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'f426bb35088033c46452481156f37c10', 'grade': False, 'grade_id': 'cell-c71a0651a14cbba4', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# AC_cancer_data$pred_MLR_int <- predict(MLR_state_poverty_int) # Using predict() to create estimated regression lines.

# MLR_state_poverty_int_plot <- ggplot(..., aes(
#   ...,
#   ...,
#   color = ...
# )) +
#   ...() +
#   geom_line(aes(y = pred_MLR_int), size = 1) +
#   labs(
#     title = ...,
#     x = ...,
#     y = ...
#   ) +
#   theme(
#     text = element_text(size = 16.5),
#     plot.title = element_text(face = "bold"),
#     axis.title = element_text(face = "bold"),
#     legend.title = element_text(face = "bold"),
#   ) +
#   labs(color = "State")
# MLR_state_poverty_int_plot


# your code here
AC_cancer_data$pred_MLR_int <- predict(MLR_state_poverty_int) # Using predict() to create estimated regression lines.

MLR_state_poverty_int_plot <- ggplot(AC_cancer_data, aes(
  povertyPercent,
  TARGET_deathRate,
  color = state
)) +
  geom_point() +
  geom_line(aes(y = pred_MLR_int), size = 1) +
  labs(
    title = "Relationship between Poverty Percent and Target Death Rate",
    x = "poverty Percent",
    y = "TARGET deathRate"
  ) +
  theme(
    text = element_text(size = 16.5),
    plot.title = element_text(face = "bold"),
    axis.title = element_text(face = "bold"),
    legend.title = element_text(face = "bold"),
  ) +
  labs(color = "State")
MLR_state_poverty_int_plot


```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': 'cd3ae67c54dad725f3eb6728c1a2fbf5', 'grade': True, 'grade_id': 'cell-199f87e4053a4c6b', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_4.2()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "c5cc174bb15a24f3fa07b2ecb483ed65", "grade": false, "grade_id": "cell-a679b20a69c2f10c", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
**Question 4.3**
<br>{points: 1}

Looking at the plot in **Question 4.2** and the modelling framework in **Question 4.0**, what is the fundamental assumption we are making when using an interaction MLR with a mixture of continuous and categorical explanatory variables?

**A.** The regression lines for both states have the same slope relating poverty to average mortality, but different intercepts.

**B.** The regression lines for both states have different slopes and intercepts relating poverty to average mortality.

**C.** The regression lines for both states have different slopes relating poverty to average mortality, but same intercepts.

*Assign your answer to the object `answer4.3`. Your answer should be one of `"A"`, `"B"`, or `"C"` surrounded by quotes.*
<!-- #endregion -->

```{r deletable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '45c6d0dc87f26b4b096c027433e1bec4', 'grade': False, 'grade_id': 'cell-359584e444cfad09', 'locked': False, 'schema_version': 3, 'solution': True, 'task': False}}
# answer4.3 <- 

# your code here
answer4.3 <- "B"
```

```{r deletable=FALSE, editable=FALSE, nbgrader={'cell_type': 'code', 'checksum': '054209c4a1b3d1f80c5d4425829409c6', 'grade': True, 'grade_id': 'cell-7d6e04742f94b20f', 'locked': True, 'points': 1, 'schema_version': 3, 'solution': False, 'task': False}}
test_4.3()
```

<!-- #region deletable=false editable=false nbgrader={"cell_type": "markdown", "checksum": "ea82cea1343d447245f6a95f0e1ba9e5", "grade": false, "grade_id": "cell-1976fe551cbd704a", "locked": true, "schema_version": 3, "solution": false, "task": false} -->
#### <font color="blue"> If the relation between the continuous predictor and the response changes for each  level of the categorical variable, we need to add interaction term(s). The model now has different slopes and different intercepts for each level of the categorical variable </font>  
<!-- #endregion -->
